# Sprint — 2026-02-21

## Objective
Ship N3 (global ⌥Space hotkey), N5 (GitHub Actions CI), and N6 (per-device game seed) in parallel.

## Task → Agent Assignment

| Task ID | Agent | Files Owned | Status | Commit |
|---------|-------|-------------|--------|--------|
| N3 | A (foreground) | ChessClock/ChessClock/Services/HotkeyService.swift (new), ChessClock/ChessClock/ChessClockApp.swift | pending | — |
| N5 | B (background) | .github/workflows/release.yml (new) | pending | — |
| N6 | C (background) | ChessClock/ChessClock/Services/GameScheduler.swift, ChessClock/ChessClockTests/GameSchedulerTests.swift | pending | — |

## Dependency Graph

```
N3 (Agent A) ─────────────────────► (senior) verify build + mark done
N5 (Agent B) ─────────────────────► (senior) yamllint check + mark done
N6 (Agent C) ─────────────────────► (senior) run tests + mark done

After N3 complete:
N4 → N7 (sequential, both touch ClockView.swift)
After N3+N9 agreed: N9 (touches ChessClockApp.swift like N3)
```

## Interface Contracts

### HotkeyService (N3 — Agent A)
- Located at: `ChessClock/ChessClock/Services/HotkeyService.swift`
- Uses `import Carbon` — no SPM deps
- Registers `kVK_Space` + `optionKey` as global hotkey via `RegisterEventHotKey`
- On hotkey fire: calls `NSStatusBar.system.statusItems.first?.button?.performClick(nil)` to toggle MenuBarExtra window
- `ChessClockApp.swift` instantiates `HotkeyService` as `@StateObject` or stores in a let and calls `.register()` in `.onAppear`

### GameScheduler seed (N6 — Agent C)
```swift
// Signature change — default nil means read/create from UserDefaults
static func resolve(date: Date, library: GameLibrary, seed: Int? = nil) -> (game: ChessGame, fenIndex: Int)?

// New helper (internal or private):
static func getOrCreateSeed() -> Int  // reads "deviceGameSeed" from UserDefaults, creates random if absent

// Updated formula:
let actualSeed = seed ?? getOrCreateSeed()
let gameIndex = (((halfDayIndex + actualSeed) % library.games.count) + library.games.count) % library.games.count
```
All existing tests pass a nil seed → reads UserDefaults → deterministic within a test run. ✓

### GitHub Actions (N5 — Agent B)
```yaml
# .github/workflows/release.yml
# Triggered by push of any v* tag
# macOS runner, builds Release scheme, runs scripts/build_dmg.sh
# Uploads .dmg as GitHub Release asset
```

## Agent Log
- [start] Sprint file created, agents about to launch

## Issues & Adaptations
(none yet)

## Integration Checklist
- [ ] All agents committed their work (verify: git log --oneline -10)
- [ ] Full build succeeded after all agent commits
- [ ] N3: manual verification — app launched, switch to another app, press ⌥Space → window appears
- [ ] N5: yamllint check passes
- [ ] N6: xcodebuild test passes (30+ test cases, 0 failures)
- [ ] All task IDs marked done in TODO.md
- [ ] PROGRESS.md updated
- [ ] Sprint file archived to .claude/sprints/
