# Sprint — 2026-02-21

## Objective
Ship all of Phase T (test suite T1–T6) and Phase F (bug fixes F1–F2), giving v0.2.0 its full test coverage and ring/year fixes.

## Task → Agent Assignment

| Task ID | Agent | Files Owned | Status | Commit |
|---------|-------|-------------|--------|--------|
| T1 | Senior | ChessClock.xcodeproj/project.pbxproj, xcshareddata/xcschemes/ChessClock.xcscheme, ChessClockTests/ dir | pending | — |
| T2 | Senior | ChessClock/Services/ClockService.swift | pending | — |
| T3 | Agent-A | ChessClockTests/BoardPositionTests.swift | pending | — |
| T4 | Agent-B | ChessClockTests/GameSchedulerTests.swift | pending | — |
| F1 | Agent-C | ChessClock/Views/MinuteSquareRingView.swift | pending | — |
| F2 | Agent-D | ChessClock/Views/GameInfoView.swift | pending | — |
| T5 | Senior | ChessClockTests/ClockServiceTests.swift | pending | — |
| T6 | Senior | ChessClockTests/GameLibraryTests.swift | pending | — |

## Dependency Graph

```
T1 (XCTest target) ──► T2 (ClockService refactor) ──► T5 (ClockService tests)
       │                                                        │
       ├──► T3 (BoardPosition tests)  [parallel]               ▼
       ├──► T4 (GameScheduler tests)  [parallel]         T6 (GameLibrary tests)
       └──► (F1 and F2 are independent of all above)
F1 (ring fix)   ─── independent ───┐
F2 (year fix)   ─── independent ───┘
```

## Interface Contracts

### ClockService after T2 refactor:
```swift
// makeState becomes internal (not private) and accepts an optional date
@MainActor
final class ClockService: ObservableObject {
    @Published private(set) var state: ClockState
    // ...
    // New signature — was: private static func makeState(for date: Date) -> ClockState
    static func makeState(at date: Date = Date()) -> ClockState
}
```

### Test file structure:
- All test files live in `ChessClock/ChessClockTests/` on disk
- Target uses PBXFileSystemSynchronizedRootGroup (files on disk auto-added to target)
- Use `@testable import ChessClock`
- Test target uses TEST_HOST pointing to ChessClock.app

### ChessClockTests target build settings:
- `BUNDLE_LOADER = $(BUILT_PRODUCTS_DIR)/ChessClock.app/Contents/MacOS/ChessClock`
- `TEST_HOST = $(BUNDLE_LOADER)`
- `PRODUCT_BUNDLE_IDENTIFIER = com.luclacombe.ChessClockTests`
- `SWIFT_VERSION = 5.0`, `MACOSX_DEPLOYMENT_TARGET = 13.0`

## Agent Log
[Append entries here as agents start, finish, fail, or get killed]

## Issues & Adaptations
[Document every deviation from the plan here]

## Integration Checklist
[ ] T1 committed — XCTest target added, trivial test passes
[ ] T2 committed — makeState(at:) signature, app builds unchanged
[ ] T3 committed — BoardPosition tests pass (BoardPositionTests.swift)
[ ] T4 committed — GameScheduler tests pass (GameSchedulerTests.swift)
[ ] F1 committed — ring starts at 12 o'clock (MinuteSquareRingView.swift)
[ ] F2 committed — year displays without comma (GameInfoView.swift)
[ ] T5 committed — ClockService tests pass (ClockServiceTests.swift)
[ ] T6 committed — GameLibrary tests pass, ≥25 total tests (GameLibraryTests.swift)
[ ] Full build succeeded: xcodebuild build → BUILD SUCCEEDED
[ ] Full test suite: xcodebuild test → 0 failures, ≥25 tests
[ ] All task IDs marked done in TODO.md
[ ] PROGRESS.md updated
[ ] Sprint file archived
